define(["jquery","core/ajax","mod_cloudstudio/player_render","core/str"],function($,Ajax,PlayerRender,getString){return mod_form={id_name:null,id_videourl:null,fitem_id_videourl:null,fitem_id_playersize:null,fitem_id_showcontrols:null,fitem_id_autoplay:null,init:function(engine,lang,courseSection){console.log([engine,lang,courseSection]);mod_form.id_name=$("#id_name");mod_form.id_videourl=$("#id_videourl");mod_form.fitem_id_videourl=mod_form.find_fitem("videourl");mod_form.fitem_id_videofile=mod_form.find_fitem("videofile");mod_form.fitem_id_playersize=mod_form.find_fitem("playersize");mod_form.fitem_id_showcontrols=mod_form.find_fitem("showcontrols");mod_form.fitem_id_autoplay=mod_form.find_fitem("autoplay");mod_form.id_videourl.change(mod_form.id_videourl_change);mod_form.id_videourl_change();mod_form.upload_file(engine);console.log(courseSection);if(courseSection){$("#id_generalcontainer").before(`
                    <div class="form-group row fitem has-danger">
                        <div class="col-md-3 col-form-label d-flex pb-0 pr-md-0">
                            <label class="d-inline word-break"></label>
                        </div>
                        <div class="col-md-9 form-inline align-items-start felement">
                            <div style="width:100%;">
                                <a id="kapture-open" class='btn btn-primary' 
                                   href='${M.cfg.wwwroot}/mod/cloudstudio/vendor/kapture/?${courseSection}'>
                                    ${M.util.get_string("select_cloudstudio","cloudstudio")}   
                                </a>
                                <a id="kapture-open" class='btn btn-primary' 
                                   href='${M.cfg.wwwroot}/mod/cloudstudio/vendor/kapture/?${courseSection}'>
                                    ${M.util.get_string("record_kapture","cloudstudio")}   
                                </a>
                            </div>
                        </div>
                    </div>`);mod_form.id_name.focus(function(){var videotitle=mod_form.id_name.val();$("#kapture-open").attr("href",`${M.cfg.wwwroot}/mod/cloudstudio/vendor/kapture/?${courseSection}&videotitle=${videotitle}`)})}},upload_file:function(engine){$("#id_videofile").change(function(){var filename=$(".filepicker-filename").text();if(mod_form.id_name.val()==""){mod_form.id_name.val(filename.slice(0,-4))}mod_form.id_videourl.val("[resource-file:"+filename+"]");mod_form.id_videourl.prop("readonly",true);mod_form.id_videourl_change()})},id_videourl_change:function(){var url=mod_form.id_videourl.val();mod_form.id_videourl.prop("readonly",false);var promise=Ajax.call([{methodname:"mod_cloudstudio_services_opengraph_getinfo",args:{url:url.replace("[link]:","")}}])[0];promise.done(function(info){if(info.title&&mod_form.id_name.val()==""){mod_form.id_name.val(info.title)}if(info.width&&info.height){var val=info.width+"x"+info.height;$("#id_playersize").append("<option value='"+val+"' selected>"+val+"</option>").val(val);mod_form.validateUrl(url);mod_form.fitem_id_playersize.hide()}else{mod_form.validateUrl(url)}});mod_form.validateUrl(url)},validateUrl:function(url){if(mod_form.testUrlResource(url)){mod_form.fitem_id_videofile.show();mod_form.fitem_id_playersize.hide();mod_form.fitem_id_showcontrols&&mod_form.fitem_id_showcontrols.show();mod_form.fitem_id_autoplay&&mod_form.fitem_id_autoplay.show();mod_form.id_videourl.prop("readonly",true)}else if(type=mod_form.testCloudStudio(url)){mod_form.fitem_id_videofile.hide();mod_form.fitem_id_playersize.hide();mod_form.fitem_id_showcontrols&&mod_form.fitem_id_showcontrols.show();mod_form.fitem_id_autoplay&&mod_form.fitem_id_autoplay.hide()}else{console.log("else");mod_form.fitem_id_videofile.show();mod_form.fitem_id_playersize.hide();mod_form.fitem_id_showcontrols&&mod_form.fitem_id_showcontrols.hide();mod_form.fitem_id_autoplay&&mod_form.fitem_id_autoplay.hide();isNotFound=true}},testCloudStudio:function(url){var re1=/^[A-Z_\-]{5,150}$/;var matches1=re1.exec(url);if(matches1&&matches1[1]){return true}var re2=/\/\w+\/\w+\/([A-Z0-9\-\_]{3,255})/;var matches2=re2.exec(url);if(matches2&&matches2[1]){return true}},testUrlResource:function(url){var re=/(\[resource-file:).*/i;var matches=re.exec(url);return matches&&matches[1]},find_fitem:function(fitem_id){var key="fitem_id_"+fitem_id;if(document.getElementById(key)){return $("#"+key)}var element=$("#id_"+fitem_id);element=element.parent();if(element.hasClass("fitem")){return element}element=element.parent();if(element.hasClass("fitem")){return element}element=element.parent();if(element.hasClass("fitem")){return element}element=element.parent();if(element.hasClass("fitem")){return element}element=element.parent();if(element.hasClass("fitem")){return element}return $("#id_"+fitem_id).parent()}}});